<?xml version="1.0" encoding="utf-8"?> <DETECTOR>   <Version>5</Version>   <CollectTel>true</CollectTel>   <!-- Set this to 1440 so that we only send bitmap once per day (data team request), if not included it defaults to 0 -->   <TelTimeoutInMinutes>1440</TelTimeoutInMinutes>   <Filters>     <Filter>       <!-- Formulas are executed in the order listed below. -->       <!-- Formulas 1 and 2 denote if the machine is an exception to OOBE or not -->       <Id Value='1'/>       <Id Value='2'/>       <!-- Formula 10 denotes if the machine is managed or unmanaged -->       <Id Value='10'/>       <!-- Formulas 4, 5, 6, 7, 9 write out the reason why a machine is managed -->       <Id Value='4'/>       <Id Value='5'/>       <Id Value='6'/>       <Id Value='7'/>       <Id Value='9'/>       <!-- Formula 8 denotes if UPX shold show or not -->       <Id Value='8'/>       <Id Value='11'/>       <Id Value='12'/>       <Id Value='13'/>     </Filter>   </Filters>   <Formulas>     <!-- NOTE: The value of ShowUI can be set explicitly by the user (denoted by the corresponding AutoSet == 0 value)                If we detect a user has set this value, we will not modify the value of ShowUI and not set any Reason Codes -->     <!-- Initialize ShowUI for exception machines -->     <Formula Id="1" Type='Regular'>       <Expression>         <AND>           <!-- If an IT Admin has explicitly set the exception key, we should not overwrite it -->           <OR>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='NEX' Resultant='0' TelOffset='0' HonorCeip='0'/>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='EQ' Resultant='1' TelOffset='1' HonorCeip='0'/>           </OR>           <OR>             <!-- Managed Exception -->             <OR>               <UNP Type='SCCM' Operation='EQ' Resultant='1' TelOffset='2' HonorCeip='0'/>               <UNP Type='DOMAIN' Operation='EQ' Resultant='1' TelOffset='3' HonorCeip='0'/>               <UNP Type='AADJ' Operation='EQ' Resultant='1' TelOffset='4' HonorCeip='0'/>               <UNP Type='RETAILDEMO' Operation='EQ' Resultant='1' TelOffset='5' HonorCeip='0'/>               <Reg Type='DWORD' Key='SOFTWARE\Microsoft\WindowsSelfHost\Applicability' Value='IsBuildFlightingEnabled' Operation='EQ' Resultant='1' TelOffset='12' HonorCeip='0'/>             </OR>             <!-- Unmanaged Exception -->             <OR>               <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='Enterprise' TelOffset='23' HonorCeip='0'/>               <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseN' TelOffset='24' HonorCeip='0'/>             </OR>           </OR>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='ShowUI' Operation='EQ' Resultant='0'/>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='EQ' Resultant='1'/>         </AND>       </Action>     </Formula>     <!-- Initialize ShowUI for Non-exception machines. This cannot be combined with the formula above since they have conflicting evaluation formats -->     <Formula Id="2" Type='Regular'>       <Expression>         <AND>           <!-- If an IT Admin has explicitly set the ShowUI value, we should not overwrite it -->           <OR>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='NEX' Resultant='0' TelOffset='0' HonorCeip='0'/>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='EQ' Resultant='1' TelOffset='1' HonorCeip='0'/>           </OR>           <!-- Not a managed exception -->           <NOT>             <OR>               <UNP Type='SCCM' Operation='EQ' Resultant='1' TelOffset='2' HonorCeip='0'/>               <UNP Type='DOMAIN' Operation='EQ' Resultant='1' TelOffset='3' HonorCeip='0'/>               <UNP Type='AADJ' Operation='EQ' Resultant='1' TelOffset='4' HonorCeip='0'/>               <UNP Type='RETAILDEMO' Operation='EQ' Resultant='1' TelOffset='5' HonorCeip='0'/>               <Reg Type='DWORD' Key='SOFTWARE\Microsoft\WindowsSelfHost\Applicability' Value='IsBuildFlightingEnabled' Operation='EQ' Resultant='1' TelOffset='12' HonorCeip='0'/>             </OR>           </NOT>           <!-- Not an unmanaged exception -->           <NOT>             <OR>               <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='Enterprise' TelOffset='23' HonorCeip='0'/>               <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseN' TelOffset='24' HonorCeip='0'/>             </OR>           </NOT>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='ShowUI' Operation='EQ' Resultant='1'/>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='EQ' Resultant='1'/>         </AND>       </Action>     </Formula>          <!-- Mark a machine as an Unmanaged Machine here (for detectoids) Only if Admin did not set AutoSet = 0 -->     <Formula Id="10" Type='Regular'>       <Expression>         <AND>           <OR>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='NEX' Resultant='0' TelOffset='0' HonorCeip='0'/>             <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='AutoSet' Operation='EQ' Resultant='1' TelOffset='1' HonorCeip='0'/>           </OR>           <NOT>             <OR>               <UNP Type='SCCM' Operation='EQ' Resultant='1' TelOffset='2' HonorCeip='0'/>               <UNP Type='DOMAIN' Operation='EQ' Resultant='1' TelOffset='3' HonorCeip='0'/>               <UNP Type='AADJ' Operation='EQ' Resultant='1' TelOffset='4' HonorCeip='0'/>               <UNP Type='RETAILDEMO' Operation='EQ' Resultant='1' TelOffset='5' HonorCeip='0'/>               <Reg Type='DWORD' Key='SOFTWARE\Microsoft\WindowsSelfHost\Applicability' Value='IsBuildFlightingEnabled' Operation='EQ' Resultant='1' TelOffset='12' HonorCeip='0'/>             </OR>           </NOT>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='CreatorsUpdateUnmanaged' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='CreatorsUpdateUnmanaged' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Leave state on the machine as to the reasons why the exception key was set -->     <Formula Id="4" Type='Regular'>       <Expression>         <AND>           <UNP Type='SCCM' Operation='EQ' Resultant='1' TelOffset='2' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isSCCM' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isSCCM' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Sets additional Reg values for Domain joined exception -->     <Formula Id="5" Type='Regular'>       <Expression>         <AND>           <UNP Type='DOMAIN' Operation='EQ' Resultant='1' TelOffset='3' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isDomainJoined' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isDomainJoined' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Sets additional Reg values for AADJ exception -->     <Formula Id="6" Type='Regular'>       <Expression>         <AND>           <UNP Type='AADJ' Operation='EQ' Resultant='1' TelOffset='4' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isAADJ' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isAADJ' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Sets additional Reg values for RetailDemo managed exception -->     <Formula Id="7" Type='Regular'>       <Expression>         <AND>           <UNP Type='RETAILDEMO' Operation='EQ' Resultant='1' TelOffset='5' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isRetailDemo' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isRetailDemo' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Sets additional Reg values for Flighting exception -->     <Formula Id="9" Type='Regular'>       <Expression>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\WindowsSelfHost\Applicability' Value='IsBuildFlightingEnabled' Operation='EQ' Resultant='1' TelOffset='12' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isFlightingEnabled' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='isFlightingEnabled' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!-- Set any Detector blocks calculated by previous formulas.  For now, we only have the Managed block, but having this formula makes it easier to add new blocks later.          If no blocks are set, then explicitly unblock UPX -->     <Formula Id="8" Type='Regular'>       <Expression>         <OR>           <!-- If ShowUI is set to 0 either by UPX or directly by user, set a DetectorBlock -->           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\CreatorsUpdatePrivacySettings' Value='ShowUI' Operation='EQ' Resultant='0' TelOffset='11' HonorCeip='0'/>           <!-- If device is opted into flighting, set a DetectorBlock -->           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\WindowsSelfHost\Applicability' Value='IsBuildFlightingEnabled' Operation='EQ' Resultant='1' TelOffset='12' HonorCeip='0'/>           <!-- if the device is retail demo, set a detector Block -->           <!--<UNP Type='RETAILDEMO' Operation='EQ' Resultant='1' TelOffset='5' HonorCeip='0'/>-->           <OR>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseS' TelOffset='15' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseSEval' TelOffset='16' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseSN' TelOffset='17' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='EnterpriseSNEval' TelOffset='18' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='IoTUAPSubscription' TelOffset='19' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='IoTUAP' TelOffset='20' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='IoTUAPCommercial' TelOffset='21' HonorCeip='0'/>             <Reg Type='STRING' Key='SOFTWARE\Microsoft\Windows NT\CurrentVersion' Value='EditionID' Operation='EQ' Resultant='IoTMobileLTSB' TelOffset='22' HonorCeip='0'/>           </OR>         </OR>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\UNP\CampaignManager\Campaigns\{91be532c-f9f1-406a-9858-43697c6f437a}\Detector' Value='DetectorBlock' Operation='EQ' Resultant='1'/>         </AND>       </Action>       <ElseAction>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\UNP\CampaignManager\Campaigns\{91be532c-f9f1-406a-9858-43697c6f437a}\Detector' Value='DetectorBlock' Operation='EQ' Resultant='0'/>         </AND>       </ElseAction>     </Formula>     <!--Mark out the mappings of the Location setting which needs system context to read-->     <!--If the Key's value is 0, set the mapped key to 0-->     <Formula Id="11" Type='Regular'>       <Expression>         <AND>           <Reg Type='DWORD' Key='SYSTEM\CurrentControlSet\Services\lfsvc\Service\Configuration' Value='Status' Operation='EQ' Resultant='0' TelOffset='25' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\UNP\Detector\{91be532c-f9f1-406a-9858-43697c6f437a}\State' Value='HklmConfigurationStatus' Operation='EQ' Resultant='0'/>         </AND>       </Action>     </Formula>     <!--If the Key's value is non-0, set the mapped key to 1-->     <Formula Id="12" Type='Regular'>       <Expression>         <AND>           <Reg Type='DWORD' Key='SYSTEM\CurrentControlSet\Services\lfsvc\Service\Configuration' Value='Status' Operation='NE' Resultant='0' TelOffset='26' HonorCeip='0'/>         </AND>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\UNP\Detector\{91be532c-f9f1-406a-9858-43697c6f437a}\State' Value='HklmConfigurationStatus' Operation='EQ' Resultant='1'/>         </AND>       </Action>     </Formula>     <!--If the Key or the value dont exist, set the mapped key to 2-->     <Formula Id="13" Type='Regular'>       <Expression>         <OR>           <Reg Type='DWORD' Key='SYSTEM\CurrentControlSet\Services\lfsvc\Service\Configuration' Value='Status' Operation='NEX' Resultant='0' TelOffset='27' HonorCeip='0'/>           <Reg Type='DWORD' Key='SYSTEM\CurrentControlSet\Services\lfsvc\Service\Configuration' Value='Status' Operation='NKEX' Resultant='0' TelOffset='28' HonorCeip='0'/>         </OR>       </Expression>       <Action>         <AND>           <Reg Type='DWORD' Key='SOFTWARE\Microsoft\UNP\Detector\{91be532c-f9f1-406a-9858-43697c6f437a}\State' Value='HklmConfigurationStatus' Operation='EQ' Resultant='2'/>         </AND>       </Action>     </Formula>   </Formulas> </DETECTOR>